<!DOCTYPE html>
<html>
<head>
  <!-- Подключение Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const supabaseUrl = 'https://xjimqtbzbxqmkgavizxy.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhqaW1xdGJ6YnhxbWtnYXZpenh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ1ODMzNDQsImV4cCI6MjA3MDE1OTM0NH0.QeZIjiYR1HcUzvAqUOnjXbFCMyxY9P6SbzQKWQm-ueI'
    const supabase = supabase.createClient(supabaseUrl, supabaseKey)
  </script>

  <style>
    .character-card {
      display: flex;
      border: 1px solid #ddd;
      margin: 10px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .character-card:hover {
      background-color: #f5f5f5;
      transform: translateY(-2px);
    }
    .selected {
      border: 2px solid #4CAF50;
      background-color: #f0fff0;
    }
  </style>
</head>
<body>
  <div style="max-width: 800px; margin: 0 auto;">
    <h2>Выберите персонажа</h2>
    <div id="characters-container"></div>
    
    <h3>Режим игры</h3>
    <select id="game-mode">
      <option value="solo">Соло</option>
      <option value="multiplayer" disabled>Мультиплеер (скоро)</option>
    </select>
    <button onclick="startGame()">Начать игру</button>
  </div>

  <script>
    let selectedCharacterId = null;

    // Загрузка персонажей из Supabase
    async function loadCharacters() {
      const { data, error } = await supabase
        .from('characters')
        .select('*')
        .order('created_at', { ascending: false });

      if (error) {
        console.error('Ошибка загрузки:', error);
        return;
      }

      const container = document.getElementById('characters-container');
      container.innerHTML = '';

      data.forEach(char => {
        const card = document.createElement('div');
        card.className = 'character-card';
        card.innerHTML = `
          <div>
            <h3>${char.name}</h3>
            <p>${char.race} | ${char.class}</p>
            <p><small>Создан: ${new Date(char.created_at).toLocaleDateString()}</small></p>
          </div>
        `;
        
        // Обработчик выбора персонажа
        card.onclick = () => {
          document.querySelectorAll('.character-card').forEach(c => c.classList.remove('selected'));
          card.classList.add('selected');
          selectedCharacterId = char.id;
        };

        container.appendChild(card);
      });
    }

    // Начать игру с выбранным персонажем
    async function startGame() {
      if (!selectedCharacterId) {
        alert('Выберите персонажа!');
        return;
      }

      // Сохраняем выбранного персонажа в localStorage
      const { data } = await supabase
        .from('characters')
        .select('*')
        .eq('id', selectedCharacterId)
        .single();

      if (data) {
        localStorage.setItem('currentCharacter', JSON.stringify(data));
        window.location.href = "game";
      } else {
        alert('Ошибка загрузки персонажа');
      }
    }

    // Загружаем персонажей при открытии страницы
    document.addEventListener('DOMContentLoaded', loadCharacters);
  </script>
</body>
</html>